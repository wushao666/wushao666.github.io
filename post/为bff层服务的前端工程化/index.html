<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>为BFF层服务的前端工程化 - 吴少在Coding</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="吴少林" /><meta name="description" content="本节是为了BFF层设计的前端基建内容，在做前端基建之前，还是要再次复习一下我们之前的BFF服务端架构设计，方便我们更好的配合它做基建。 这套工" />






<meta name="generator" content="Hugo 0.92.2 with theme even" />


<link rel="canonical" href="http://wushao666.github.io/post/%E4%B8%BAbff%E5%B1%82%E6%9C%8D%E5%8A%A1%E7%9A%84%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="为BFF层服务的前端工程化" />
<meta property="og:description" content="本节是为了BFF层设计的前端基建内容，在做前端基建之前，还是要再次复习一下我们之前的BFF服务端架构设计，方便我们更好的配合它做基建。 这套工" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://wushao666.github.io/post/%E4%B8%BAbff%E5%B1%82%E6%9C%8D%E5%8A%A1%E7%9A%84%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2025-03-26T10:35:43+08:00" />
<meta property="article:modified_time" content="2025-03-27T16:17:13+08:00" />

<meta itemprop="name" content="为BFF层服务的前端工程化">
<meta itemprop="description" content="本节是为了BFF层设计的前端基建内容，在做前端基建之前，还是要再次复习一下我们之前的BFF服务端架构设计，方便我们更好的配合它做基建。 这套工"><meta itemprop="datePublished" content="2025-03-26T10:35:43+08:00" />
<meta itemprop="dateModified" content="2025-03-27T16:17:13+08:00" />
<meta itemprop="wordCount" content="11788">
<meta itemprop="keywords" content="BFF层," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="为BFF层服务的前端工程化"/>
<meta name="twitter:description" content="本节是为了BFF层设计的前端基建内容，在做前端基建之前，还是要再次复习一下我们之前的BFF服务端架构设计，方便我们更好的配合它做基建。 这套工"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">吴少在Coding</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">吴少在Coding</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">为BFF层服务的前端工程化</h1>

      <div class="post-meta">
        <span class="post-time"> 2025-03-26 </span>
        <div class="post-category">
            <a href="/categories/bff/"> BFF </a>
            </div>
          <span class="more-meta"> 约 11788 字 </span>
          <span class="more-meta"> 预计阅读 24 分钟 </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#这一节要干啥">这一节要干啥</a></li>
    <li><a href="#前端工程化">前端工程化</a>
      <ul>
        <li><a href="#解析编译">解析编译</a></li>
        <li><a href="#模块分包">👍模块分包</a></li>
        <li><a href="#生产环境的优化">👍🏻👍🏻👍🏻生产环境的优化</a></li>
        <li><a href="#减小-webpack-打包体积">减小 Webpack 打包体积</a></li>
      </ul>
    </li>
    <li><a href="#通用优化思路">👍🏻👍🏻👍🏻通用优化思路</a>
      <ul>
        <li><a href="#1性能优化直接影响用户体验">1、性能优化（直接影响用户体验）</a></li>
        <li><a href="#2构建优化开发体验优化">2、构建优化（开发体验优化）</a></li>
        <li><a href="#3代码质量优化">3、代码质量优化</a></li>
        <li><a href="#衡量优化效果">👍🏻衡量优化效果</a></li>
      </ul>
    </li>
    <li><a href="#-开发环境优化">👍 开发环境优化</a>
      <ul>
        <li><a href="#热更新原理">👍👍👍热更新原理</a></li>
      </ul>
    </li>
    <li><a href="#基础建设">基础建设</a>
      <ul>
        <li><a href="#请求适配器">请求适配器</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>本节是为了BFF层设计的前端基建内容，在做前端基建之前，还是要再次复习一下我们之前的<a href="/post/bff%E7%9A%84%E6%9C%8D%E5%8A%A1%E7%AB%AF%E8%AE%BE%E8%AE%A1">BFF服务端架构设计</a>，方便我们更好的配合它做基建。</p>
<p>这套工程化是根据当前的BFF需求（下图所示）而设计的。
<img src="/images/nova-bff/BFF-structure.png" alt="nova-core">
这套架构提供统一的入口，通过多页面入口来分发不同的系统（应用）。</p>
<p><strong>本文内容较长，核心内容使用👍🏻（👍）的标志标注，补充说明某个概念使用双分割线包裹。</strong></p>
<h2 id="这一节要干啥">这一节要干啥</h2>
<p>设计BFF是想解耦纯后端和页面访问，BFF层做一部分请求的工作，更好的服务页面的接口需求。
而上一章节的服务端设计，是通过封装koa，实现了一套egg.js的架构。用一系列的中间件、loader去实现bff层的底座。
<img src="/images/nova-bff/nova-core-structure.png" alt="nova-core"></p>
<p>仔细看bff层的业务逻辑中的核心有一个页面模版，也就是我们koa-core要去访问、解析tpl文件，展示层在通过koa-router的路由访问对应的页面。</p>
<p>而这里的模版就是我们本节要去实现的，它必然是动态生成的。要把/app/pages下的对应页面解析成对应的页面模版。
<img src="/images/nova-bff/1742982008281.jpg" alt="nova-core"></p>
<p>但是实际开发中我们会有很多资源依赖，可能会用react或者vue开发，可能会用less\sass。
所以要用打包工具去处理。</p>
<p>这一节会做两件事：</p>
<ol>
<li>前端工程化</li>
<li>为了让开发过程更加高效，做一部分前端基础建设。</li>
</ol>
<p>综上所述，这一节要完成下图中间部分：
<img src="/images/nova-bff/webpack.png" alt="webpack">
当做完解析后，输出的产物，koa服务端就可以直接访问了。</p>
<h2 id="前端工程化">前端工程化</h2>
<p>前端工程化主要打包工具来实现，至于你用vite还是webpack，还是xxx，都不重要，重要的是从工程化的思路去处理，不同环境下该做什么，每种情况处理的逻辑基本都是相通的。</p>
<p>我选了webpack5来实践。
在回顾一下这张图：<img src="/images/nova-bff/webpack.png" alt="webpack">
解析引擎要做三件事：</p>
<ol>
<li>解析编译</li>
<li>模块分包</li>
<li>压缩优化
不同的打包工具，api使用上不同，但是核心逻辑都是这些，继续细化一下。</li>
</ol>
<h3 id="解析编译">解析编译</h3>
<ul>
<li>通过入口(entry)，进行依赖分析，遇到import和其他引用的资源，都认为是module</li>
<li>然后module按照不同的rules通过合适的loader进行处理</li>
<li>最终生成output产物。</li>
</ul>
<hr>
<p>👍 loader怎么寻找的</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="nx">module</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">rules</span><span class="o">:</span> <span class="p">[</span>
      <span class="c1">//? 例如webpack怎么找到vue-loader
</span><span class="c1"></span>      <span class="p">{</span>
        <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.vue$/</span><span class="p">,</span>
        <span class="nx">use</span><span class="o">:</span> <span class="p">{</span>
          <span class="nx">loader</span><span class="o">:</span> <span class="s1">&#39;vue-loader&#39;</span>
        <span class="p">}</span>
      <span class="p">},</span>
    <span class="p">]</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>在 webpack 的模块解析机制中，loader 的查找遵循规则：<strong>从当前目录向上找</strong>。</p>
<p>举个🌰：
<code>当执行 node ./app/webpack/dev.js 时</code>，node_modules 查找顺序：</p>
<ol>
<li>/Users/wushao/wushaoDev/FE-stuty/nova/app/webpack/node_modules ❌</li>
<li>/Users/wushao/wushaoDev/FE-stuty/nova/app/node_modules ❌</li>
<li>/Users/wushao/wushaoDev/FE-stuty/nova/node_modules ✅ (正确位置)</li>
</ol>
<p><strong>路径解析伪代码逻辑</strong>：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="c1">// 伪代码演示 webpack 内部查找过程
</span><span class="c1"></span><span class="kd">function</span> <span class="nx">resolveLoader</span><span class="p">(</span><span class="nx">loaderName</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// 1. 检查是否绝对路径
</span><span class="c1"></span>  <span class="k">if</span> <span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">isAbsolute</span><span class="p">(</span><span class="nx">loaderName</span><span class="p">))</span> <span class="k">return</span> <span class="nx">loaderName</span>
  
  <span class="c1">// 2. 相对路径解析（从当前文件所在目录）
</span><span class="c1"></span>  <span class="k">if</span> <span class="p">(</span><span class="nx">loaderName</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="s1">&#39;./&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="nx">loaderName</span><span class="p">)</span>
  <span class="p">}</span>
  
  <span class="c1">// 3. 从 node_modules 向上递归查找（当前项目的 node_modules）
</span><span class="c1"></span>  <span class="k">return</span> <span class="nx">require</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">loaderName</span><span class="p">)</span> 
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>如果要自定义 loader 解析路径，可以修改配置（但不推荐）：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="c1">// 在 module.exports 中添加：
</span><span class="c1"></span><span class="nx">resolveLoader</span><span class="o">:</span> <span class="p">{</span>
  <span class="nx">modules</span><span class="o">:</span> <span class="p">[</span>
    <span class="s1">&#39;node_modules&#39;</span><span class="p">,</span> <span class="c1">// 默认值
</span><span class="c1"></span>    <span class="s1">&#39;/global/node_modules&#39;</span> <span class="c1">// 自定义全局路径（不推荐）
</span><span class="c1"></span>  <span class="p">]</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<p>解析编译的前两步的一些基础操作，开发环境和生成环境都需要，可以使用base.js来抽象，至于产物，生产和开发环境差别很大，要单独处理。</p>
<p>在最终的构建阶段会通过配置插件，在打包的不同生命周期中生效，去改变打包的结果，例如要生成html或者tpl</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript">
  <span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span>
    <span class="c1">// 把vue中的script、style标签应用 modules.rules的对应规则
</span><span class="c1"></span>    <span class="k">new</span> <span class="nx">VueLoaderPlugin</span><span class="p">(),</span>
    <span class="c1">// 把第三方库暴露到window context下
</span><span class="c1"></span>    <span class="k">new</span> <span class="nx">webpack</span><span class="p">.</span><span class="nx">ProvidePlugin</span><span class="p">({</span>
      <span class="nx">Vue</span><span class="o">:</span> <span class="s1">&#39;vue&#39;</span><span class="p">,</span>
      <span class="nx">axios</span><span class="o">:</span> <span class="s1">&#39;axios&#39;</span><span class="p">,</span>
      <span class="s1">&#39;_&#39;</span><span class="o">:</span> <span class="s1">&#39;lodash&#39;</span><span class="p">,</span>
    <span class="p">}),</span>
    <span class="c1">//! 定义全局常量，例如vue相关的
</span><span class="c1"></span>    <span class="k">new</span> <span class="nx">webpack</span><span class="p">.</span><span class="nx">DefinePlugin</span><span class="p">({</span>
      <span class="nx">__VUE_OPTIONS_API__</span><span class="o">:</span> <span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="c1">// 支持options api
</span><span class="c1"></span>      <span class="nx">__VUE_PROD_DEVTOOLS__</span><span class="o">:</span> <span class="s1">&#39;false&#39;</span><span class="p">,</span> <span class="c1">// 禁用调试工具，打包时不需要这个了
</span><span class="c1"></span>      <span class="nx">__VUE_PROD_HYDRATION_MISMATCH_DETAILS__</span><span class="o">:</span> <span class="s1">&#39;false&#39;</span><span class="p">,</span> <span class="c1">// 禁用生产环境显示水合信息
</span><span class="c1"></span>    <span class="p">}),</span>
    <span class="c1">// 构造最终的页面模版
</span><span class="c1"></span>    <span class="k">new</span> <span class="nx">HtmlWebpackPlugin</span><span class="p">({</span>
      <span class="nx">filename</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="c1">// 把文件生成到哪
</span><span class="c1"></span>      <span class="nx">template</span><span class="o">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">cwd</span><span class="p">(),</span> <span class="s2">&#34;./app/view/entry.tpl&#34;</span><span class="p">),</span> <span class="c1">// 使用的原始模版
</span><span class="c1"></span>      <span class="nx">chunks</span><span class="o">:</span> <span class="p">[</span><span class="nx">entryName</span><span class="p">],</span>
    <span class="p">})</span>
  <span class="p">],</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<p>可以看到插件中：<code>__VUE_PROD_HYDRATION_MISMATCH_DETAILS__: 'false', // 禁用生产环境显示水合信息</code>
在 Vue 和 React 这类前端框架里，“水合”（Hydration）是个关键概念，“水合信息”就和水合过程产生的数据或者状态有关。</p>
<p><strong>水合的概念</strong>
在服务器端渲染（SSR）或者静态站点生成（SSG）的场景中，服务端先把 HTML 渲染好，然后发送到客户端。客户端拿到这些 HTML 后，要把它变成可交互的应用程序，这个过程就是水合。</p>
<p>简单来说，水合就是把静态的 HTML 和框架里的 JavaScript 代码关联起来，让页面具有交互性。</p>
<p><strong>水合信息的本质</strong>：
水合信息指的是在水合过程中用到的、和组件状态、事件监听器等相关的数据。具体包含以下内容：</p>
<ul>
<li><strong>组件状态</strong>：像组件里的变量、数据这些状态信息。在水合的时候，客户端要把这些状态恢复到和服务端渲染时一样的状态。</li>
<li><strong>事件监听器</strong>：比如 <code>click</code>、<code>input</code> 这类事件的监听器。水合过程会把这些事件监听器添加到对应的 DOM 元素上，这样页面才能响应用户的操作。</li>
<li><strong>生命周期钩子</strong>：组件的生命周期钩子函数在水合的时候会被触发，从而保证组件能正确地初始化和渲染。</li>
</ul>
<p>下面是 Vue 和 React 中关于水合的简单示例代码：</p>
<p>Vue 示例</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-vue" data-lang="vue"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">button</span> <span class="nt">@click</span><span class="s">=&#34;increment&#34;</span><span class="p">&gt;</span><span class="na">点击</span><span class="o">:</span> <span class="p">{{</span> <span class="na">count</span> <span class="p">}}&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="kr">export</span> <span class="k">default</span> <span class="p">{</span>
  <span class="nx">data</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="nx">count</span><span class="o">:</span> <span class="mi">0</span>
    <span class="p">};</span>
  <span class="p">},</span>
  <span class="nx">methods</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">increment</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">count</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">};</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>在 Vue 的 SSR 中，服务端会渲染出初始的 HTML，包含 <code>count</code> 的初始值 <code>0</code>。客户端进行水合时，会恢复 <code>count</code> 的状态，并且给按钮添加 <code>click</code> 事件监听器，这样点击按钮就能更新 <code>count</code> 的值。</p>
<p>React 示例</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="kr">import</span> <span class="nx">React</span><span class="p">,</span> <span class="p">{</span> <span class="nx">useState</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;react&#39;</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">Counter</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="p">[</span><span class="nx">count</span><span class="p">,</span> <span class="nx">setCount</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="p">=&gt;</span> <span class="nx">setCount</span><span class="p">(</span><span class="nx">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)}&gt;</span><span class="nx">点击</span><span class="o">:</span> <span class="p">{</span><span class="nx">count</span><span class="p">}&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">);</span>
<span class="p">};</span>

<span class="kr">export</span> <span class="k">default</span> <span class="nx">Counter</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><p>在 React 的 SSR 里，服务端会渲染出初始的 HTML，客户端水合时会恢复 <code>count</code> 的状态，同时给按钮添加 <code>onClick</code> 事件监听器，让按钮可以正常响应点击事件。</p>
<p><strong>禁用生产环境显示水合信息的原因</strong></p>
<p>在生产环境中禁用水合信息的显示，主要是为了提高性能和安全性。显示水合信息可能会带来额外的开销，而且有可能泄露一些敏感的应用程序状态信息。通常框架会默认在生产环境下关闭这些调试信息的显示。</p>
<hr>
<p>上面构造最终的页面模版，因为涉及到多页面，不希望写多份入口文件和多个渲染模版：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="c1">// 多入口
</span><span class="c1"></span><span class="nx">entry</span><span class="o">:</span> <span class="p">{</span>
  <span class="s1">&#39;entry.page1&#39;</span><span class="o">:</span> <span class="s1">&#39;./app/pages/page1/entry.page1.js&#39;</span><span class="p">,</span>
  <span class="s1">&#39;entry.page2&#39;</span><span class="o">:</span> <span class="s1">&#39;./app/pages/page2/entry.page2.js&#39;</span><span class="p">,</span>
<span class="p">}</span>
<span class="c1">// 多个渲染模版
</span><span class="c1"></span><span class="p">[</span>
  <span class="k">new</span> <span class="nx">HtmlWebpackPlugin</span><span class="p">({</span>
    <span class="nx">filename</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="c1">// 把文件生成到哪
</span><span class="c1"></span>    <span class="nx">template</span><span class="o">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">cwd</span><span class="p">(),</span> <span class="s2">&#34;./app/view/entry.tpl&#34;</span><span class="p">),</span> <span class="c1">// 使用的原始模版
</span><span class="c1"></span>    <span class="nx">chunks</span><span class="o">:</span> <span class="p">[</span><span class="nx">entryName</span><span class="p">],</span>
  <span class="p">}),</span>
  <span class="k">new</span> <span class="nx">HtmlWebpackPlugin</span><span class="p">({</span>
    <span class="nx">filename</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="c1">// 把文件生成到哪
</span><span class="c1"></span>    <span class="nx">template</span><span class="o">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">cwd</span><span class="p">(),</span> <span class="s2">&#34;./app/view/entry.tpl&#34;</span><span class="p">),</span> <span class="c1">// 使用的原始模版
</span><span class="c1"></span>    <span class="nx">chunks</span><span class="o">:</span> <span class="p">[</span><span class="nx">entryName</span><span class="p">],</span>
  <span class="p">}),</span>
  <span class="c1">// ...
</span><span class="c1"></span><span class="p">]</span>
 
</code></pre></td></tr></table>
</div>
</div><p>所以在base.js初始化时，动态构造多页面入口和多页面渲染模版：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kr">const</span> <span class="nx">glob</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;glob&#34;</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">entryList</span> <span class="o">=</span> <span class="p">{}</span>
<span class="kr">const</span> <span class="nx">htmlWebpackPluginList</span> <span class="o">=</span> <span class="p">[]</span>

<span class="kr">const</span> <span class="nx">pageList</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">cwd</span><span class="p">(),</span> <span class="s1">&#39;./app/pages/**/entry.*.js&#39;</span><span class="p">)</span>
<span class="c1">//!!! 借助glob获取所有的filePath
</span><span class="c1"></span><span class="nx">glob</span><span class="p">.</span><span class="nx">sync</span><span class="p">(</span><span class="nx">pageList</span><span class="p">).</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">filePath</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="c1">//这个filePath就是 相当于&#39;xxx/app/pages/page1/entry.page1.js&#39;
</span><span class="c1"></span>  
  <span class="c1">//去掉.js后缀，拿到前面的名字，例如entry.page1
</span><span class="c1"></span>  <span class="kr">const</span> <span class="nx">entryName</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">basename</span><span class="p">(</span><span class="nx">filePath</span><span class="p">,</span> <span class="s1">&#39;.js&#39;</span><span class="p">)</span>
  
  <span class="c1">//!!! 构造多入口的对象
</span><span class="c1"></span>  <span class="nx">entryList</span><span class="p">[</span><span class="nx">entryName</span><span class="p">]</span> <span class="o">=</span> <span class="nx">filePath</span>
  <span class="c1">// 相当于写死的这个配置
</span><span class="c1"></span>  <span class="c1">// {
</span><span class="c1"></span>  <span class="c1">//   &#39;entry.page1&#39;: &#39;./app/pages/page1/entry.page1.js&#39;,
</span><span class="c1"></span>  <span class="c1">//   &#39;entry.page2&#39;: &#39;./app/pages/page2/entry.page2.js&#39;,
</span><span class="c1"></span>  <span class="c1">// }
</span><span class="c1"></span>  <span class="nx">htmlWebpackPluginList</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span>
    <span class="c1">//! 添加的是HtmlWebpackPlugin对象
</span><span class="c1"></span>    <span class="k">new</span> <span class="nx">HtmlWebpackPlugin</span><span class="p">({</span>
      <span class="nx">filename</span><span class="o">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span>
        <span class="nx">process</span><span class="p">.</span><span class="nx">cwd</span><span class="p">(),</span>
        <span class="s2">&#34;./app/public/dist/&#34;</span><span class="p">,</span>
        <span class="sb">`</span><span class="si">${</span><span class="nx">entryName</span><span class="si">}</span><span class="sb">.tpl`</span>
      <span class="p">),</span>
      <span class="nx">template</span><span class="o">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">cwd</span><span class="p">(),</span> <span class="s2">&#34;./app/view/entry.tpl&#34;</span><span class="p">),</span>
      <span class="nx">chunks</span><span class="o">:</span> <span class="p">[</span><span class="nx">entryName</span><span class="p">],</span>
    <span class="p">})</span>
  <span class="p">);</span>
  
<span class="p">});</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="模块分包">👍模块分包</h3>
<p>如果多个组件使用一个公共文件，或者都引用了vue，没有必要都打到一个entry文件中。</p>
<p>合理的分包，根据不同包的使用频率、改动频率，更好的利用浏览器的并发请求特性，也能更好的利用缓存。
例如vue库、某些ui库改的机会不多，单独打包出来。</p>
<hr>
<p>更重要的是，webpack的运行时代码，如果不单独处理，打到entry文件中，当某个chunk内容改变，运行时代码不变，但hash值也会改变，影响缓存。</p>
<p>分离后,只有运行时代码改变才会影响运行时chunk的hash
webpack运行时代码包含：</p>
<ul>
<li>webpack的模块加载系统</li>
<li>模块缓存逻辑</li>
<li>异步chunk加载逻辑</li>
</ul>
<hr>
<p>配置分包策略，一般分为三种包：</p>
<ol>
<li>vendor包，代表第三方包，基本不会改动，除非依赖版本升级</li>
<li>common，代表一些业务组件的公共部分，单独提取出来，改动较少</li>
<li>entry.page1_3c02631e.bundle 包，代表不同的页面（业务）组件代码，经常改动</li>
</ol>
<p>这样处理后，可以实现：</p>
<ul>
<li>更好的缓存效果</li>
<li>减少主包体积</li>
<li>运行时代码从主包中抽离， runtime很少改变,可以长期缓存，runtime可以和其他chunk并行加载</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript">  <span class="nx">optimization</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">splitChunks</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">chunks</span><span class="o">:</span> <span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="c1">// all 异步 同步都分割。例如动态导入（import()）的代码只会在需要时候才加载，减少初始加载时间
</span><span class="c1"></span>      <span class="c1">// minSize: 20000, //生成 chunk 的最小体积（以 bytes 为单位）。
</span><span class="c1"></span>      <span class="nx">maxAsyncRequests</span><span class="o">:</span> <span class="mi">10</span><span class="p">,</span> <span class="c1">//按需加载时（异步加载）的最大并行请求数
</span><span class="c1"></span>      <span class="nx">maxInitialRequests</span><span class="o">:</span> <span class="mi">10</span><span class="p">,</span> <span class="c1">//入口点的最大并行请求数。
</span><span class="c1"></span>      <span class="c1">//! 具体的三个分包，缓存组
</span><span class="c1"></span>      <span class="nx">cacheGroups</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">vendor</span><span class="o">:</span> <span class="p">{</span>
          <span class="c1">//! 匹配node_modules目录，windows和Linux斜杠
</span><span class="c1"></span>          <span class="nx">test</span><span class="o">:</span> <span class="sr">/[\\/]node_modules[\\/]/</span><span class="p">,</span>
          <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;vendor&#39;</span><span class="p">,</span> <span class="c1">//模块名称
</span><span class="c1"></span>          <span class="nx">priority</span><span class="o">:</span> <span class="mi">20</span><span class="p">,</span>
          <span class="nx">enforce</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">//强制执行
</span><span class="c1"></span>          <span class="nx">reuseExistingChunk</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">//重用之前页面已打出来的包
</span><span class="c1"></span>        <span class="p">},</span>
        <span class="nx">common</span><span class="o">:</span> <span class="p">{</span>
          <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;common&#39;</span><span class="p">,</span>
          <span class="nx">minChunks</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span> <span class="c1">// 被几处引用过，这里配置被两处引用就认为是公共模块
</span><span class="c1"></span>          <span class="nx">minSize</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="c1">//最小分割文件大小 byte
</span><span class="c1"></span>          <span class="nx">priority</span><span class="o">:</span> <span class="mi">10</span><span class="p">,</span>
          <span class="nx">reuseExistingChunk</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">//重用之前页面已打出来的包
</span><span class="c1"></span>        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="c1">// 将webpack运行时代码打包到runtime.js
</span><span class="c1"></span>    <span class="nx">runtimeChunk</span><span class="o">:</span> <span class="kc">true</span>
  <span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="生产环境的优化">👍🏻👍🏻👍🏻生产环境的优化</h3>
<ol>
<li>具体的output</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="nx">output</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">filename</span><span class="o">:</span> <span class="s2">&#34;js/[name]_[chunkhash:8].bundle.js&#34;</span><span class="p">,</span>
    <span class="c1">// 自定义的文件路径
</span><span class="c1"></span>    <span class="nx">path</span><span class="o">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">cwd</span><span class="p">(),</span> <span class="s2">&#34;./app/public/dist/prod&#34;</span><span class="p">),</span>
    <span class="c1">//! 根路径, 注意要用绝对路径! /开头
</span><span class="c1"></span>    <span class="nx">publicPath</span><span class="o">:</span> <span class="s2">&#34;/dist/prod&#34;</span><span class="p">,</span>
    <span class="c1">//! 配置跨域
</span><span class="c1"></span>    <span class="nx">crossOriginLoading</span><span class="o">:</span> <span class="s2">&#34;anonymous&#34;</span><span class="p">,</span>
  <span class="p">},</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<p>chunkhash和contenthash区别</p>
<ol>
<li><strong>生成规则</strong>:</li>
</ol>
<ul>
<li>chunkhash基于 Chunk 内容生成，根据每个 chunk（代码块）的内容来生成哈希值。在 Webpack 打包过程中，代码会被分割成多个 chunk，chunkhash 会为每个 chunk 计算一个唯一的哈希值。</li>
</ul>
<p>相同 Chunk 内容相同哈希：只要 chunk 的内容不变，生成的 chunkhash 就不会改变。例如，某个 JavaScript 文件属于一个特定的 chunk，当该文件内容没有发生变化时，其对应的 chunkhash 也不会改变。</p>
<ul>
<li>contenthash基于文件内容生成：contenthash 是根据每个文件的具体内容来生成哈希值。它会逐字节地比较文件内容，只要文件内容有任何改变，生成的 contenthash 就会不同。</li>
</ul>
<p>文件独立性：每个文件都有自己独立的 contenthash，不受其他文件的影响。即使两个文件属于同一个 chunk，只要它们的内容不同，contenthash 也会不同。</p>
<ol start="2">
<li><strong>使用场景</strong></li>
</ol>
<ul>
<li>chunkhash适用于代码分割场景：在大型项目中，通常会使用代码分割（如动态导入）将代码分割成多个 chunk，以实现按需加载。使用 chunkhash 可以确保当某个 chunk 的内容发生变化时，只有该 chunk 的文件名会改变，而其他 chunk 的文件名保持不变，从而避免不必要的缓存失效。</li>
</ul>
<p>示例：假设一个项目有一个主 chunk 和多个动态导入的 chunk，当动态导入的 chunk 内容发生变化时，只有该 chunk 的文件名会更新，主 chunk 的文件名不变，用户在访问页面时，主 chunk 可以继续使用浏览器缓存，减少了不必要的网络请求。</p>
<ul>
<li>contenthash适用于 CSS 文件，使用 contenthash 可以确保当 CSS 文件内容发生变化时，其文件名也会改变，从而让浏览器重新下载更新后的 CSS 文件。由于 CSS 文件通常是独立于 JavaScript 文件进行处理的，使用 contenthash 可以更精确地控制 CSS 文件的缓存。</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span>
    <span class="k">new</span> <span class="nx">MiniCssExtractPlugin</span><span class="p">({</span>
        <span class="nx">filename</span><span class="o">:</span> <span class="s1">&#39;[name].[contenthash].css&#39;</span><span class="p">,</span>
        <span class="nx">chunkFilename</span><span class="o">:</span> <span class="s1">&#39;[id].[contenthash].css&#39;</span>
    <span class="p">})</span>
<span class="p">]</span>
</code></pre></td></tr></table>
</div>
</div><p>除了 CSS 文件，对于其他静态资源（如图片、字体等），也可以使用 contenthash 来确保资源内容更新时，文件名也会相应改变，从而使浏览器能够获取到最新的资源。</p>
<hr>
<ol start="2">
<li>多线程build，使用terserPlugin</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kr">const</span> <span class="nx">TerserPlugin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;terser-webpack-plugin&#39;</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">os</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;os&#39;</span><span class="p">)</span>
<span class="c1">// 取代happypack，用线程池来并行处理module，加快打包（构建）速度
</span><span class="c1">// 只在处理耗时的 loader 前置添加这个loader:
</span><span class="c1">// 例如适合处理计算密集型的加载器，像 babel-loader、less-loader 等。
</span><span class="c1">// 对于一些轻量级的加载器，使用 thread-loader 可能不会带来明显的性能提升，
</span><span class="c1">// 甚至可能由于进程间通信的开销而导致性能下降。
</span><span class="c1">//! 必须放在加载器链的第一个位置，这样后续的加载器才能在独立的进程中执行。
</span><span class="c1">//!!! 一个例外：MiniCssExtractPlugin.loader 要在它前面
</span><span class="c1">// 因为：thread-loader会把后续的 loader 放到独立的 worker 进程里执行，
</span><span class="c1">// 以此提升构建速度。
</span><span class="c1">// 但 MiniCssExtractPlugin.loader 要在主进程里和 Webpack 构建流程紧密配合
</span><span class="c1">// 所以不能放在 thread-loader 后面。
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">threadLoader</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;thread-loader&#39;</span><span class="p">);</span>
<span class="c1">//! 预热工作线程池（worker）:在启动时预先加载一些模块, 会增加初始启动时间
</span><span class="c1">// 不过会减少后续的加载时间，所以要依据项目的规模和构建频率来决定是否启用。
</span><span class="c1"></span><span class="nx">threadLoader</span><span class="p">.</span><span class="nx">warmup</span><span class="p">(</span>
  <span class="p">{</span>
    <span class="c1">//!!! 配置池选项，这些选项必须与后续在 loader 中使用的选项一样
</span><span class="c1"></span>    <span class="c1">// 也就是说后面module.rules中的thread-loader的option必须和下面的一样，才能正确预热。
</span><span class="c1"></span>    <span class="c1">//! 设置worker数量，根据需求调整，默认cpu - 1
</span><span class="c1"></span>    <span class="nx">workers</span><span class="o">:</span> <span class="nx">os</span><span class="p">.</span><span class="nx">cpus</span><span class="p">().</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> 
    <span class="nx">workerParallelJobs</span><span class="o">:</span> <span class="mi">50</span><span class="p">,</span> <span class="c1">// 每个工作线程的并行任务数
</span><span class="c1"></span>    <span class="c1">//! 额外的 Node.js 参数
</span><span class="c1"></span>    <span class="nx">workerNodeArgs</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;--max-old-space-size=2048&#39;</span><span class="p">],</span>
    <span class="nx">poolRespawn</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span> <span class="c1">// 是否允许重新生成死亡的工作线程池
</span><span class="c1"></span>    <span class="nx">poolTimeout</span><span class="o">:</span> <span class="mi">2000</span><span class="p">,</span> <span class="c1">// 工作线程池空闲时的超时时间
</span><span class="c1"></span>    <span class="nx">poolParallelJobs</span><span class="o">:</span> <span class="mi">50</span><span class="p">,</span> <span class="c1">// 工作线程池分配给每个工作线程的任务数
</span><span class="c1"></span>    <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;nova-pool&#39;</span><span class="p">,</span> <span class="c1">// 工作线程池的名称
</span><span class="c1"></span>  <span class="p">},</span>
  <span class="p">[</span>
    <span class="c1">// 列出你想要预先加载到工作线程池中的模块
</span><span class="c1"></span>    <span class="s1">&#39;babel-loader&#39;</span><span class="p">,</span>
  <span class="p">],</span>
<span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><ol start="3">
<li>资源优化：</li>
</ol>
<ul>
<li>图片压缩、合适的小图用url编码，默认base64</li>
<li>字体处理，按需加载字体库，或者使用cdn字体库</li>
</ul>
<ol start="4">
<li>构建（打包）流程优化</li>
</ol>
<ul>
<li>持久化本地缓存</li>
<li>并行处理耗时的那些loader，例如在babel-loader、css-loader等loader链头部使用thread-loader</li>
<li>去除无用代码：js代码用TreeShaking、PureCSS去除没有用到的css</li>
</ul>
<ol start="5">
<li>打包输出的优化</li>
</ol>
<ul>
<li>清理之前的目录内容</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="k">new</span> <span class="nx">CleanWebpackPlugin</span><span class="p">([</span><span class="s2">&#34;public/dist&#34;</span><span class="p">],</span> <span class="p">{</span>
  <span class="nx">root</span><span class="o">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">cwd</span><span class="p">(),</span> <span class="s2">&#34;./app/&#34;</span><span class="p">),</span>
  <span class="nx">exclude</span><span class="o">:</span> <span class="p">[],</span> <span class="c1">//排除xxx
</span><span class="c1"></span>  <span class="nx">verbose</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">//去除日志
</span><span class="c1"></span>  <span class="nx">dry</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
<span class="p">}),</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>提取css文件，可以更好的利用浏览器并行请求的特性。</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="c1">// webpack.config.js
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">MiniCssExtractPlugin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;mini-css-extract-plugin&#39;</span><span class="p">);</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">module</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">rules</span><span class="o">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.css$/</span><span class="p">,</span>
                <span class="nx">use</span><span class="o">:</span> <span class="p">[</span>
                    <span class="nx">MiniCssExtractPlugin</span><span class="p">.</span><span class="nx">loader</span><span class="p">,</span>
                    <span class="s1">&#39;css-loader&#39;</span>
                <span class="p">]</span>
            <span class="p">}</span>
        <span class="p">]</span>
    <span class="p">},</span>
    <span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span>
        <span class="k">new</span> <span class="nx">MiniCssExtractPlugin</span><span class="p">({</span>
            <span class="nx">filename</span><span class="o">:</span> <span class="s1">&#39;[name].[contenthash].css&#39;</span><span class="p">,</span>
            <span class="nx">chunkFilename</span><span class="o">:</span> <span class="s1">&#39;[id].[contenthash].css&#39;</span>
        <span class="p">})</span>
    <span class="p">]</span>
<span class="p">};</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>预加载和预取
<a href="https://webpack.docschina.org/guides/code-splitting/#prefetchingpreloading-modules">内置模块</a></li>
</ul>
<ol start="6">
<li>安全性的插件</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="c1">// 允许你在 Webpack 构建过程中，自动向 HTML 文件里的特定标签（如 &lt;script&gt;、&lt;link&gt; 等）添加自定义属性。
</span><span class="c1">// 在你需要为这些标签添加额外的属性以满足特定需求时非常有用，
</span><span class="c1">// 比如添加 defer、async 属性来控制脚本的加载行为，或者添加自定义的 data-* 属性用于前端脚本进行数据传递和交互。
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">HtmlWebpackInjectAttributesPlugin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;html-webpack-inject-attributes-plugin&#34;</span><span class="p">);</span>

<span class="c1">// 浏览器请求资源时，不发送用户的身份凭证
</span><span class="c1"></span>  <span class="k">new</span> <span class="nx">HtmlWebpackInjectAttributesPlugin</span><span class="p">({</span>
    <span class="nx">crossorigin</span><span class="o">:</span> <span class="s1">&#39;anonymous&#39;</span>
  <span class="p">})</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<p>crossorigin 是 HTML 标签（主要是 <code>&lt;script&gt;、&lt;link&gt;、&lt;img&gt;</code>等）的一个属性,
用于控制跨域资源的请求方式，它有以下两个主要取值：</p>
<ol>
<li>anonymous：<strong>表示在请求跨域资源时，不会发送用户的凭证（如 cookie、HTTP 认证信息等）。
浏览器会发起一个跨域请求，但不会包含任何用户的身份信息。</strong></li>
<li>use-credentials：表示在请求跨域资源时，会发送用户的凭证。
如果服务器端没有正确配置 CORS（跨域资源共享）允许携带凭证，请求将会失败。</li>
</ol>
<hr>
<p>之前的分包策略，万一有的包太大，请求很慢呢？</p>
<p><strong>借助performance发现</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="nx">performance</span><span class="o">:</span> <span class="p">{</span>
  <span class="nx">hints</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
  <span class="nx">maxAssetSize</span><span class="o">:</span> <span class="mi">250000</span><span class="p">,</span> <span class="c1">// 限制单个资源文件最大250k
</span><span class="c1"></span>  <span class="nx">maxEntrypointSize</span><span class="o">:</span> <span class="mi">400000</span><span class="p">,</span> <span class="c1">// 入口点所有资源文件大小
</span><span class="c1"></span><span class="p">},</span>
</code></pre></td></tr></table>
</div>
</div><p>超了之后可以用警告或者错误提示，这一点提醒我们：在打包时要关注分包大小。</p>
<hr>
<h3 id="减小-webpack-打包体积">减小 Webpack 打包体积</h3>
<h4 id="1-代码分割code-splitting">1. 代码分割（Code Splitting）</h4>
<p>代码分割能把大的代码包拆分成多个小的代码包，按需加载，从而减少初始加载的资源大小。Webpack 支持多种代码分割方式，如入口点分割、动态导入等。</p>
<p><strong>动态导入示例</strong>：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="c1">// 在需要使用模块的地方动态导入
</span><span class="c1"></span><span class="kr">async</span> <span class="kd">function</span> <span class="nx">loadComponent</span><span class="p">()</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="p">{</span> <span class="k">default</span><span class="o">:</span> <span class="nx">component</span> <span class="p">}</span> <span class="o">=</span> <span class="kr">await</span> <span class="kr">import</span><span class="p">(</span><span class="s1">&#39;./path/to/component&#39;</span><span class="p">);</span>
  <span class="k">return</span> <span class="nx">component</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="2-压缩代码">2. 压缩代码</h4>
<p>使用插件对 JavaScript、CSS 等代码进行压缩，去除多余的空格、注释和不必要的代码。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="nx">optimization</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">minimize</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nx">minimizer</span><span class="o">:</span> <span class="p">[</span>
      <span class="c1">//! 多线程压缩和混淆js，并移除console.
</span><span class="c1"></span>      <span class="k">new</span> <span class="nx">TerserPlugin</span><span class="p">({</span>
        <span class="nx">parallel</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// 启用多核CPU加速
</span><span class="c1"></span>        <span class="nx">terserOptions</span><span class="o">:</span> <span class="p">{</span>
          <span class="nx">compress</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">drop_console</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// 去除console
</span><span class="c1"></span>          <span class="p">},</span>
        <span class="p">},</span>
      <span class="p">}),</span>
      <span class="c1">// 压缩css
</span><span class="c1"></span>      <span class="k">new</span> <span class="nx">CssMinimizerPlugin</span><span class="p">(),</span>
    <span class="p">],</span>
  <span class="p">},</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="3-去除无用代码tree-shaking">3. 去除无用代码（Tree Shaking）</h4>
<p>Tree Shaking 是一种消除未使用代码的技术。Webpack 在生产模式下默认支持 Tree Shaking，但需要确保代码使用 ES6 模块语法，并且使用支持 Tree Shaking 的打包工具和配置。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="c1">// utils.js
</span><span class="c1"></span><span class="kr">export</span> <span class="kd">function</span> <span class="nx">add</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">a</span> <span class="o">+</span> <span class="nx">b</span><span class="p">;</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="kd">function</span> <span class="nx">subtract</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">a</span> <span class="o">-</span> <span class="nx">b</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// main.js
</span><span class="c1"></span><span class="kr">import</span> <span class="p">{</span> <span class="nx">add</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./utils&#39;</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><p>在上述代码中，<code>subtract</code> 函数未被使用，在生产构建时会被 Tree Shaking 移除。</p>
<h4 id="4-图片优化">4. 图片优化</h4>
<p>使用 <code>image-webpack-loader</code> 等插件对图片进行压缩和优化，减少图片文件的大小。
上面只是在处理模块阶段基本的优化，构建的阶段，要进行更细致的压缩image-minimizer-webpack-plugin。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="nx">npm</span> <span class="nx">install</span> <span class="nx">image</span><span class="o">-</span><span class="nx">minimizer</span><span class="o">-</span><span class="nx">webpack</span><span class="o">-</span><span class="nx">plugin</span> <span class="nx">imagemin</span> <span class="nx">imagemin</span><span class="o">-</span><span class="nx">gifsicle</span> <span class="nx">imagemin</span><span class="o">-</span><span class="nx">mozjpeg</span> <span class="nx">imagemin</span><span class="o">-</span><span class="nx">pngquant</span> <span class="nx">imagemin</span><span class="o">-</span><span class="nx">svgo</span> <span class="o">--</span><span class="nx">save</span><span class="o">-</span><span class="nx">dev</span>
<span class="kr">const</span> <span class="nx">ImageMinimizerPlugin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;image-minimizer-webpack-plugin&#39;</span><span class="p">);</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">module</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">rules</span><span class="o">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.(png|jpg|gif)$/i</span><span class="p">,</span>
        <span class="nx">use</span><span class="o">:</span> <span class="p">[</span>
          <span class="p">{</span>
            <span class="nx">loader</span><span class="o">:</span> <span class="s1">&#39;file-loader&#39;</span>
          <span class="p">},</span>
          <span class="p">{</span>
            <span class="nx">loader</span><span class="o">:</span> <span class="nx">ImageMinimizerPlugin</span><span class="p">.</span><span class="nx">loader</span><span class="p">,</span>
            <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
              <span class="nx">minimizer</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">implementation</span><span class="o">:</span> <span class="nx">ImageMinimizerPlugin</span><span class="p">.</span><span class="nx">imageminMinify</span><span class="p">,</span>
                <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
                  <span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span>
                    <span class="p">[</span><span class="s1">&#39;gifsicle&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">interlaced</span><span class="o">:</span> <span class="kc">true</span> <span class="p">}],</span>
                    <span class="p">[</span><span class="s1">&#39;jpegtran&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">progressive</span><span class="o">:</span> <span class="kc">true</span> <span class="p">}],</span>
                    <span class="p">[</span><span class="s1">&#39;optipng&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">optimizationLevel</span><span class="o">:</span> <span class="mi">5</span> <span class="p">}]</span>
                  <span class="p">]</span>
                <span class="p">}</span>
              <span class="p">}</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">]</span>
      <span class="p">}</span>
    <span class="p">]</span>
  <span class="p">}</span>
<span class="p">};</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="5-使用-cdn">5. 使用 CDN</h4>
<p>对于一些常用的第三方库，如 React、Vue、jQuery 等，可以使用 CDN（内容分发网络）来加载，减少本地打包的资源大小。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="c">&lt;!-- 在 HTML 文件中使用 CDN 加载 React --&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;https://cdn.jsdelivr.net/npm/react@17.0.2/umd/react.production.min.js&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;https://cdn.jsdelivr.net/npm/react-dom@17.0.2/umd/react-dom.production.min.js&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="6-配置-externals">6. 配置 externals</h4>
<p>如果使用了 CDN 加载某些库，可以通过 <code>externals</code> 配置告诉 Webpack 这些库不需要打包到最终的代码中。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">externals</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">react</span><span class="o">:</span> <span class="s1">&#39;React&#39;</span><span class="p">,</span>
    <span class="s1">&#39;react-dom&#39;</span><span class="o">:</span> <span class="s1">&#39;ReactDOM&#39;</span>
  <span class="p">}</span>
<span class="p">};</span>
</code></pre></td></tr></table>
</div>
</div><p>通过以上这些方法，可以有效地减小 Webpack 打包后资源的大小，提高应用的加载性能。</p>
<h2 id="通用优化思路">👍🏻👍🏻👍🏻通用优化思路</h2>
<p>分析上面的一系列操作，可以总结出一些规律：无论什么打包工具，在做大型项目时，都有三类优化需要去做，根据对应打包工具的文档和社区做就行。</p>
<p>重要是：</p>
<ol>
<li>要知道做什么能优化。</li>
<li>什么情形下该优化。</li>
<li>如何衡量优化后的效果。</li>
</ol>
<p>这一节来解决这三个问题。</p>
<p>从性能优化、构建优化和代码质量优化三个方式来做优化。</p>
<h3 id="1性能优化直接影响用户体验">1、性能优化（直接影响用户体验）</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="c1">// webpack.prod.js
</span><span class="c1"></span><span class="nx">optimization</span><span class="o">:</span> <span class="p">{</span>
  <span class="nx">splitChunks</span><span class="o">:</span> <span class="p">{</span> <span class="c1">// 代码分割
</span><span class="c1"></span>    <span class="nx">cacheGroups</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">vendor</span><span class="o">:</span> <span class="p">{</span> <span class="c1">// 第三方包分离
</span><span class="c1"></span>        <span class="nx">test</span><span class="o">:</span> <span class="sr">/[\\/]node_modules[\\/]/</span><span class="p">,</span>
        <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;vendor&#39;</span>
      <span class="p">},</span>
      <span class="nx">common</span><span class="o">:</span> <span class="p">{</span> <span class="c1">// 公共模块分离
</span><span class="c1"></span>        <span class="nx">minChunks</span><span class="o">:</span> <span class="mi">2</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="nx">runtimeChunk</span><span class="o">:</span> <span class="kc">true</span> <span class="c1">// 运行时代码分离
</span><span class="c1"></span><span class="p">},</span>
<span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span>
  <span class="k">new</span> <span class="nx">MiniCssExtractPlugin</span><span class="p">(),</span> <span class="c1">// CSS 提取
</span><span class="c1"></span>  <span class="k">new</span> <span class="nx">PurgeCSSPlugin</span><span class="p">(),</span> <span class="c1">// 删除无用 CSS
</span><span class="c1"></span>  <span class="k">new</span> <span class="nx">CssMinimizerPlugin</span><span class="p">(),</span> <span class="c1">// CSS 压缩
</span><span class="c1"></span>  <span class="k">new</span> <span class="nx">TerserPlugin</span><span class="p">()</span> <span class="c1">// JS 压缩
</span><span class="c1"></span><span class="p">]</span>
</code></pre></td></tr></table>
</div>
</div><p>目的是：</p>
<ul>
<li>减少首屏资源体积（代码分割）</li>
<li>提升缓存利用率（合适的分包策略）</li>
<li>减少 CSS/JS 文件体积（压缩优化）</li>
</ul>
<h3 id="2构建优化开发体验优化">2、构建优化（开发体验优化）</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="c1">// webpack.prod.js
</span><span class="c1"></span><span class="p">{</span>
  <span class="nx">loader</span><span class="o">:</span> <span class="s2">&#34;thread-loader&#34;</span><span class="p">,</span> <span class="c1">// 线程池加速
</span><span class="c1"></span>  <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">workers</span><span class="o">:</span> <span class="nx">os</span><span class="p">.</span><span class="nx">cpus</span><span class="p">().</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>目的是：</p>
<ul>
<li>多进程并行构建（thread-loader）</li>
<li>预热线程池（warmup 配置）</li>
<li>开发环境热更新（HMR）</li>
</ul>
<h3 id="3代码质量优化">3、代码质量优化</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="c1">// webpack.base.js
</span><span class="c1"></span><span class="p">{</span>
  <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.js$/</span><span class="p">,</span>
  <span class="nx">include</span><span class="o">:</span> <span class="p">[</span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="s1">&#39;./app/pages&#39;</span><span class="p">)],</span> <span class="c1">// 限定 Babel 编译范围
</span><span class="c1"></span>  <span class="nx">use</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;babel-loader&#39;</span><span class="p">]</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p><strong><a href="https://webpack.docschina.org/guides/code-splitting/#prefetchingpreloading-modules">预加载和预取</a></strong>：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="c1">// webpack.prod.js
</span><span class="c1"></span><span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span>
  <span class="k">new</span> <span class="nx">PreloadWebpackPlugin</span><span class="p">({</span>
    <span class="nx">rel</span><span class="o">:</span> <span class="s1">&#39;preload&#39;</span><span class="p">,</span>
    <span class="nx">include</span><span class="o">:</span> <span class="s1">&#39;initial&#39;</span>
  <span class="p">})</span>
<span class="p">]</span>
</code></pre></td></tr></table>
</div>
</div><p>目的是：</p>
<ul>
<li>避免全量编译（精准 include 配置）</li>
<li>类型检查（通过 TS/Vue 模板编译）</li>
<li>各种lint校验</li>
<li>合适时机加载相关资源</li>
</ul>
<table>
<thead>
<tr>
<th>优化类型</th>
<th>具体方案</th>
<th>适用场景</th>
</tr>
</thead>
<tbody>
<tr>
<td>加载性能优化</td>
<td>代码分割 (SplitChunksPlugin)</td>
<td>多路由/多入口应用</td>
</tr>
<tr>
<td>缓存优化</td>
<td>文件名哈希 (contenthash)</td>
<td>长期缓存策略</td>
</tr>
<tr>
<td>资源压缩</td>
<td>图片压缩 (image-webpack-loader)</td>
<td>图片资源较多的项目</td>
</tr>
<tr>
<td>构建速度优化</td>
<td>多进程构建 (thread-loader)</td>
<td>大型项目构建加速</td>
</tr>
</tbody>
</table>
<ol start="3">
<li><strong>Bundle 分析</strong>：</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">npx webpack-bundle-analyzer stats.json
</code></pre></td></tr></table>
</div>
</div><h3 id="衡量优化效果">👍🏻衡量优化效果</h3>
<ol>
<li><strong>构建速度对比</strong> (使用 <code>speed-measure-webpack-plugin</code>)</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">npm install --save-dev speed-measure-webpack-plugin
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kr">const</span> <span class="nx">SpeedMeasurePlugin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;speed-measure-webpack-plugin&#39;</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">smp</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SpeedMeasurePlugin</span><span class="p">()</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">smp</span><span class="p">.</span><span class="nx">wrap</span><span class="p">(</span><span class="nx">webpackConfig</span><span class="p">)</span> <span class="c1">// 包裹原配置
</span></code></pre></td></tr></table>
</div>
</div><p><strong>输出示例</strong>：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">LoaderA: 12.34s
LoaderB: 8.12s 
Total build time: 38.56s (优化前 62.34s)
</code></pre></td></tr></table>
</div>
</div><ol start="2">
<li><strong>体积分析</strong> (使用 <code>webpack-bundle-analyzer</code>)</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">npm install --save-dev webpack-bundle-analyzer
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kr">const</span> <span class="p">{</span> <span class="nx">BundleAnalyzerPlugin</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;webpack-bundle-analyzer&#39;</span><span class="p">)</span>

<span class="c1">// 在 plugins 数组中添加：
</span><span class="c1"></span><span class="k">new</span> <span class="nx">BundleAnalyzerPlugin</span><span class="p">({</span>
  <span class="nx">analyzerMode</span><span class="o">:</span> <span class="s1">&#39;static&#39;</span><span class="p">,</span>
  <span class="nx">reportFilename</span><span class="o">:</span> <span class="s1">&#39;bundle-report.html&#39;</span>
<span class="p">})</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>输出效果</strong>：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">vendor.xxxx.js    1.2MB → 876KB (↓27%)
entry.page1.js    512KB → 324KB (↓36%)
</code></pre></td></tr></table>
</div>
</div><hr>
<p>还有一种生成静态文件的分析方法：在 Webpack 工程中生成<code>stats.json</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># 在项目根目录执行（MacOS）</span>
webpack --profile --json &gt; stats.json
</code></pre></td></tr></table>
</div>
</div><p>或通过配置生成（推荐）：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="c1">// 修改 webpack 配置
</span><span class="c1"></span><span class="nx">webpack</span><span class="p">(</span><span class="nx">webpackConfig</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">stats</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="k">throw</span> <span class="nx">err</span>
  
  <span class="c1">// 生成 stats.json
</span><span class="c1"></span>  <span class="nx">fs</span><span class="p">.</span><span class="nx">writeFileSync</span><span class="p">(</span>
    <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">&#39;stats.json&#39;</span><span class="p">),</span>
    <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">stats</span><span class="p">.</span><span class="nx">toJson</span><span class="p">(</span><span class="s1">&#39;verbose&#39;</span><span class="p">))</span>
  <span class="p">)</span>
<span class="p">})</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="statsjson-包含的关键信息">stats.json 包含的关键信息</h4>
<table>
<thead>
<tr>
<th>分析维度</th>
<th>具体数据</th>
<th>优化方向案例</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>模块体积</strong></td>
<td>每个模块的原始大小、gzip后大小</td>
<td>发现 2.8MB 的 <code>moment.js</code> → 改用 <code>dayjs</code></td>
</tr>
<tr>
<td><strong>重复依赖</strong></td>
<td>相同模块在不同 chunk 中的重复次数</td>
<td><code>lodash</code> 在 5 个 chunk 重复 → 提取到公共 chunk</td>
</tr>
<tr>
<td><strong>入口依赖</strong></td>
<td>首屏加载必须的核心资源列表</td>
<td><code>main.js</code> 含 30+ 路由组件 → 改为动态导入</td>
</tr>
<tr>
<td><strong>第三方占比</strong></td>
<td><code>node_modules</code> 代码在总包中的比例</td>
<td>占比 78% → 使用 CDN 加载 <code>react</code>、<code>vue</code> 等</td>
</tr>
<tr>
<td><strong>缓存失效</strong></td>
<td>文件哈希值变化频率</td>
<td><code>vendor.js</code> 每周都变 → 调整 splitChunks 策略</td>
</tr>
</tbody>
</table>
<h4 id="典型分析案例">典型分析案例</h4>
<p>结合自己的项目去分析，以我的代码片段为例：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="c1">// stats.json 片段示例
</span><span class="c1"></span><span class="p">{</span>
  <span class="s2">&#34;assets&#34;</span><span class="o">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="s2">&#34;name&#34;</span><span class="o">:</span> <span class="s2">&#34;vendor.1234.js&#34;</span><span class="p">,</span>
      <span class="s2">&#34;size&#34;</span><span class="o">:</span> <span class="mi">1024000</span><span class="p">,</span>  <span class="c1">// 1MB
</span><span class="c1"></span>      <span class="s2">&#34;chunks&#34;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&#34;vendors~main&#34;</span><span class="p">],</span> 
      <span class="s2">&#34;chunkNames&#34;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&#34;vendors~main&#34;</span><span class="p">]</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="s2">&#34;name&#34;</span><span class="o">:</span> <span class="s2">&#34;src_pages_Home.5678.js&#34;</span><span class="p">,</span>
      <span class="s2">&#34;size&#34;</span><span class="o">:</span> <span class="mi">256000</span><span class="p">,</span>   <span class="c1">// 256KB
</span><span class="c1"></span>      <span class="s2">&#34;chunks&#34;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&#34;src_pages_Home&#34;</span><span class="p">]</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>对应的优化建议：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="c1">// 修改分包策略
</span><span class="c1"></span><span class="nx">optimization</span><span class="o">:</span> <span class="p">{</span>
  <span class="nx">splitChunks</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">cacheGroups</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">vendor</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">test</span><span class="o">:</span> <span class="sr">/[\\/]node_modules[\\/](react|react-dom)[\\/]/</span><span class="p">,</span>
        <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;react-vendor&#39;</span> <span class="c1">// 单独提取 React 相关
</span><span class="c1"></span>      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>也可视化分析：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">npx webpack-bundle-analyzer /xxx/stats.json
</code></pre></td></tr></table>
</div>
</div><p>浏览器查看：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">http://127.0.0.1:8888
</code></pre></td></tr></table>
</div>
</div><hr>
<ol start="3">
<li><strong>真实场景测试</strong> (Chrome DevTools)</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="c1">// 在项目入口添加性能监控
</span><span class="c1"></span><span class="nx">console</span><span class="p">.</span><span class="nx">time</span><span class="p">(</span><span class="s1">&#39;First Paint&#39;</span><span class="p">)</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;load&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">timeEnd</span><span class="p">(</span><span class="s1">&#39;First Paint&#39;</span><span class="p">)</span> <span class="c1">// 优化前 3.2s → 优化后 1.8s
</span><span class="c1"></span><span class="p">})</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<p>应该输出一份这个类似的报告作为结果：</p>
<table>
<thead>
<tr>
<th>优化类型</th>
<th>典型提升幅度</th>
<th>数据来源</th>
</tr>
</thead>
<tbody>
<tr>
<td>代码分割</td>
<td>首屏体积↓30-50%</td>
<td>Webpack 官方性能报告</td>
</tr>
<tr>
<td>多线程构建</td>
<td>构建时间↓20-40%</td>
<td>Terser 官方基准测试</td>
</tr>
<tr>
<td>图片转 WebP</td>
<td>图片体积↓25-35%</td>
<td>Google 开发者文档</td>
</tr>
<tr>
<td>按需引入 (lodash)</td>
<td>包体积↓40-60%</td>
<td>Lodash 官方迁移指南</td>
</tr>
</tbody>
</table>
<p>结论：</p>
<p>在系统优化中，通过代码分割和缓存策略，首屏资源体积减少了约40%，构建时间从平均90秒缩短到55秒左右。具体来说：</p>
<ol>
<li>将 <code>lodash</code> 改为按需引入，减少 420KB 的包体积</li>
<li>使用 <code>thread-loader</code> 后，<code>babel-loader</code> 阶段的耗时减少 35%&quot;</li>
</ol>
<p>通过 <code>webpack-bundle-analyzer</code> 分析发现，<code>node_modules</code> 代码占比达78%。实施分包策略后：</p>
<ul>
<li>首屏资源从 2.1MB 降至 1.4MB (↓33%)</li>
<li>二次加载因缓存命中率提升，加载时间从 3.2s 降至 1.1s</li>
<li>完整构建耗时从 86s 优化至 49s (↓43%)&quot;</li>
</ul>
<hr>
<h2 id="-开发环境优化">👍 开发环境优化</h2>
<p>对比<a href="#%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E7%9A%84%E4%BC%98%E5%8C%96">生产环境的优化</a>，基本上除了webpack.base.js，额外做的优化不多，为了开发调试方便，会启用sourcemap</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="nx">devtool</span><span class="o">:</span> <span class="s1">&#39;eval-cheap-module-source-map&#39;</span><span class="p">,</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<p>👍🏻sourcemap分类：
对于开发环境
以下选项非常适合开发环境，通常会从以下四种挑一个：
<img src="/images/nova-bff/devtools.jpg" alt="devtools"></p>
<p>开始时期望看到源码，所以通过生成代码后的信息，选择后两种，再从build的速度，最终选择了<code>eval-cheap-module-source-map</code></p>
<blockquote>
<ol>
<li>eval - 每个模块都使用 eval() 执行，并且都有 //# sourceURL。此选项会非常快地构建。主要缺点是，由于会映射到转换后的代码，而不是映射到原始代码（没有从 loader 中获取 source map），所以不能正确的显示行数。</li>
<li>eval-source-map - 每个模块使用 eval() 执行，并且 source map 转换为 DataUrl 后添加到 eval() 中。初始化 source map 时比较慢，但是会在重新构建时提供比较快的速度，并且生成实际的文件。行数能够正确映射，因为会映射到原始代码中。它会生成用于开发环境的最佳品质的 source map。</li>
<li>eval-cheap-source-map - 类似 eval-source-map，每个模块使用 eval() 执行。这是 &ldquo;cheap(低开销)&rdquo; 的 source map，因为它没有生成列映射(column mapping)，只是映射行数。它会忽略源自 loader 的 source map，并且仅显示转译后的代码，就像 eval devtool。</li>
<li>eval-cheap-module-source-map - 类似 eval-cheap-source-map，并且，在这种情况下，源自 loader 的 source map 会得到更好的处理结果。然而，loader source map 会被简化为每行一个映射(mapping)。</li>
</ol>
</blockquote>
<p><a href="https://webpack.docschina.org/configuration/devtool/#devtool">官网详细分类解释</a></p>
<p><a href="https://github.com/webpack/webpack/tree/main/examples/source-map">官网分类示例代码</a></p>
<hr>
<p>开发时的动态代码不落盘，直接放到内存中，通过HMR做热更新。
主要是理解HMR原理。</p>
<h3 id="热更新原理">👍👍👍热更新原理</h3>
<p>要做热更新，先知道要做哪些事情，才能做到：本地代码变了，页面跟着刷新。
是不是需要一个服务能处理静态文件目录（static），能监听源码变化，同时他还能和页面进行通信，得让页面有可以双向通信的能力，将变化后的代码注入到页面中。
这个服务，就是所谓的devServer，他有三个能力：</p>
<ol>
<li>监控源码变化</li>
<li>往浏览器注入一些代码，使浏览器具备双向通信的能力，本地代码变化了告诉浏览器，浏览器去拉新代码，刷新页面</li>
<li>开辟适量的内存空间，存储代码片段。
所以原理如图所示：
<img src="/images/nova-bff/HMR.png" alt="HMR"></li>
</ol>
<p>压缩优化完的代码走两个分支：</p>
<ol>
<li>分支2：tpl模版直接落盘就好</li>
<li>分支1：模版依赖的资源，通过访问一个在线地址动态更新，而这个动态地址就指向内存中的代码片段。这个分支把每次优化后的代码注入到devServer的内存中即可。</li>
</ol>
<p>实现上，用express做devServer，在用两个express能够使用的中间件：<code>webpack-dev-middle、webpack-hot-middleware</code>，实现监控能力、双向通信的能力。
<img src="/images/nova-bff/HMR-implement.png" alt="HMR-implement">
其中：</p>
<ul>
<li><code>webpack-dev-middle</code>中间件使express服务器具备监控能力、将 webpack 编译输出托管到内存文件系统（分支1）、落地tpl文件（分支2）</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="c1">// DevMiddleware 内部实现伪代码
</span><span class="c1"></span><span class="nx">compiler</span><span class="p">.</span><span class="nx">outputFileSystem</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MemoryFileSystem</span><span class="p">()</span>
<span class="nx">compiler</span><span class="p">.</span><span class="nx">watch</span><span class="p">({},</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">stats</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="c1">// 将编译结果存入内存
</span><span class="c1"></span><span class="p">})</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li><code>webpack-hot-middleware</code> 实现<code>HMR</code>热模块替换</li>
</ul>
<p>用代码描述的话：</p>
<ol>
<li>在dev.js中要暴露devServer的配置（尤其注意官方要求的<code>HMR_PATH: '__webpack_hmr'</code>）</li>
<li>重写入口文件，除第三方包外需要做hmr 增加热更新的配置地址。</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="c1">// webpack.dev.js核心代码
</span><span class="c1">// devServer配置
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">DEV_SERVER_CONFIG</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">HOST</span><span class="o">:</span> <span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span>
  <span class="nx">PORT</span><span class="o">:</span> <span class="mi">9002</span><span class="p">,</span>
  <span class="nx">HMR_PATH</span><span class="o">:</span> <span class="s1">&#39;__webpack_hmr&#39;</span><span class="p">,</span> <span class="c1">// 官方规定
</span><span class="c1"></span>  <span class="nx">TIMEOUT</span><span class="o">:</span> <span class="mi">20</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span> <span class="c1">// 20秒
</span><span class="c1"></span><span class="p">}</span>

<span class="c1">// 开发环境希望的是entry入口文件改了，就更新，所以肯定不是固定的入口路径
</span><span class="c1">// 要通过热替换模块（HMR）来实现代码更改，通知页面更新
</span><span class="c1"></span><span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">webpackBaseConfig</span><span class="p">.</span><span class="nx">entry</span><span class="p">).</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">entryName</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="c1">//! 回忆一下三种分包策略，第三方包肯定不需要做hmr
</span><span class="c1"></span>  <span class="k">if</span><span class="p">(</span><span class="nx">entryName</span> <span class="o">!==</span> <span class="s1">&#39;vendor&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="p">{</span>
      <span class="nx">HOST</span><span class="p">,</span>
      <span class="nx">PORT</span><span class="p">,</span>
      <span class="nx">HMR_PATH</span><span class="p">,</span>
      <span class="nx">TIMEOUT</span><span class="p">,</span>
    <span class="p">}</span> <span class="o">=</span> <span class="nx">DEV_SERVER_CONFIG</span>
    <span class="c1">//! 重新给入口文件赋值
</span><span class="c1"></span>    <span class="nx">webpackBaseConfig</span><span class="p">.</span><span class="nx">entry</span><span class="p">[</span><span class="nx">entryName</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
      <span class="c1">// 原来的主入口文件
</span><span class="c1"></span>      <span class="nx">webpackBaseConfig</span><span class="p">.</span><span class="nx">entry</span><span class="p">[</span><span class="nx">entryName</span><span class="p">],</span>
      <span class="c1">// hmr官方入口，client后面的查询字符串部分是用来给客户端传递配置参数的
</span><span class="c1"></span>      <span class="sb">`webpack-hot-middleware/client?path=http://</span><span class="si">${</span><span class="nx">HOST</span><span class="si">}</span><span class="sb">:</span><span class="si">${</span><span class="nx">PORT</span><span class="si">}</span><span class="sb">/</span><span class="si">${</span><span class="nx">HMR_PATH</span><span class="si">}</span><span class="sb">&amp;timeout=</span><span class="si">${</span><span class="nx">TIMEOUT</span><span class="si">}</span><span class="sb">&amp;reload=true`</span>
    <span class="p">]</span>
  <span class="p">}</span>
<span class="p">})</span>

<span class="kr">const</span> <span class="p">{</span>
  <span class="nx">HOST</span><span class="p">,</span>
  <span class="nx">PORT</span><span class="p">,</span>
<span class="p">}</span> <span class="o">=</span> <span class="nx">DEV_SERVER_CONFIG</span>
<span class="c1">// 开发环境webpack配置
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">webpackConfig</span> <span class="o">=</span> <span class="nx">merge</span><span class="p">.</span><span class="nx">smart</span><span class="p">(</span><span class="nx">webpackBaseConfig</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">mode</span><span class="o">:</span> <span class="s2">&#34;development&#34;</span><span class="p">,</span>
  <span class="c1">// 开启sourcemap，通过代码映射关系，方便开发环境调试代码
</span><span class="c1"></span>  <span class="nx">devtool</span><span class="o">:</span> <span class="s1">&#39;eval-cheap-module-source-map&#39;</span><span class="p">,</span>
  <span class="c1">// 开发阶段的输出产物
</span><span class="c1"></span>  <span class="nx">output</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">filename</span><span class="o">:</span> <span class="s2">&#34;js/[name]_[chunkhash:8].bundle.js&#34;</span><span class="p">,</span>
    <span class="c1">// 文件放哪
</span><span class="c1"></span>    <span class="nx">path</span><span class="o">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">cwd</span><span class="p">(),</span> <span class="s2">&#34;./app/public/dist/dev/&#34;</span><span class="p">),</span>
    <span class="c1">//! 根路径, 想想开发环境这里应该填什么
</span><span class="c1"></span>    <span class="c1">// 应该用上面的devServer配置，组装成有效的publicPath
</span><span class="c1"></span>    <span class="c1">// 也就是说会把输出的产物放到上面devServer配置后的路径上
</span><span class="c1"></span>    <span class="c1">// 既然开发环境想用热更新，他就要是个可用的本地链接。
</span><span class="c1"></span>    <span class="nx">publicPath</span><span class="o">:</span> <span class="sb">`http://</span><span class="si">${</span><span class="nx">HOST</span><span class="si">}</span><span class="sb">:</span><span class="si">${</span><span class="nx">PORT</span><span class="si">}</span><span class="sb">/public/dist/dev/`</span><span class="p">,</span>
    <span class="nx">globalObject</span><span class="o">:</span> <span class="s1">&#39;this&#39;</span><span class="p">,</span>
  <span class="p">},</span>
  <span class="c1">// 开发阶段的插件，最重要的就是热更新插件
</span><span class="c1"></span>  <span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span>
    <span class="c1">//! 开发阶段有了这个插件，才能让应用程序代码更新了，立马反应到页面变化上
</span><span class="c1"></span>    <span class="k">new</span> <span class="nx">webpack</span><span class="p">.</span><span class="nx">HotModuleReplacementPlugin</span><span class="p">({</span>
      <span class="c1">// 默认值为 false。
</span><span class="c1"></span>      <span class="c1">// 当设置为 true 时，模块热替换分两步：先更新所有的模块，再重新构建依赖图；
</span><span class="c1"></span>      <span class="c1">// 而设置为 false 时，模块热替换会一次性完成所有操作。
</span><span class="c1"></span>      <span class="c1">// 通常来说，false 能加快热替换的速度，不过可能会消耗更多的内存。
</span><span class="c1"></span>      <span class="nx">multiStep</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="p">})</span>
  <span class="p">]</span>
<span class="p">});</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">DEV_SERVER_CONFIG</span><span class="p">,</span> <span class="c1">//暴露给dev.js的开发服务器使用
</span><span class="c1"></span>  <span class="nx">webpackConfig</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>上面output的publicPath就是内存中的地址，当访问tpl时，动态加载的依赖就是他的路径：
<img src="/images/nova-bff/page222.jpg" alt="">
如果你更新代码后，这个路径会变：
<img src="/images/nova-bff/page111.jpg" alt=""></p>
<p>devServer实现上，用express来启动即可。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="err">/ 通过webpack.dev.js获取devServer配置和webpack开发环境配置</span>
<span class="kr">const</span> <span class="p">{</span>
  <span class="nx">DEV_SERVER_CONFIG</span><span class="p">,</span>
  <span class="nx">webpackConfig</span> <span class="c1">//开发配置
</span><span class="c1"></span><span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./config/webpack.dev&#39;</span><span class="p">)</span>
<span class="kr">const</span> <span class="p">{</span>
  <span class="nx">PORT</span><span class="p">,</span>
  <span class="nx">HMR_PATH</span><span class="p">,</span>
<span class="p">}</span> <span class="o">=</span> <span class="nx">DEV_SERVER_CONFIG</span>
<span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">()</span>
<span class="c1">//! 获取开发环境下，webpack解析后的内容
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">compiler</span> <span class="o">=</span> <span class="nx">webpack</span><span class="p">(</span><span class="nx">webpackConfig</span><span class="p">)</span>

<span class="c1">// 指定静态文件目录,注意后面结尾的斜杠
</span><span class="c1"></span><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="kr">static</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">&#39;../public/dist/&#39;</span><span class="p">)))</span>

<span class="c1">// 使用devMiddleware中间件，监听原始文件的变化
</span><span class="c1"></span><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">devMiddleware</span><span class="p">(</span><span class="nx">compiler</span><span class="p">,</span> <span class="p">{</span>
  <span class="c1">// 落到硬盘中的文件, 模板文件直接落盘就好
</span><span class="c1"></span>  <span class="nx">writeToDisk</span><span class="o">:</span> <span class="p">(</span><span class="nx">filePath</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">filePath</span><span class="p">.</span><span class="nx">endsWith</span><span class="p">(</span><span class="s1">&#39;.tpl&#39;</span><span class="p">),</span>
  <span class="c1">// 资源路径
</span><span class="c1"></span>  <span class="nx">publicPath</span><span class="o">:</span> <span class="nx">webpackConfig</span><span class="p">.</span><span class="nx">output</span><span class="p">.</span><span class="nx">publicPath</span><span class="p">,</span>
  <span class="c1">// 跨域配置
</span><span class="c1"></span>  <span class="nx">headers</span><span class="o">:</span> <span class="p">{</span>
    <span class="s1">&#39;Access-Control-Allow-Origin&#39;</span><span class="o">:</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Access-Control-Allow-Methods&#39;</span><span class="o">:</span> <span class="s1">&#39;GET, POST, PUT, DELETE, PATCH, OPTIONS&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Access-Control-Allow-Headers&#39;</span><span class="o">:</span> <span class="s1">&#39;X-Requested-With, content-type, Authorization&#39;</span><span class="p">,</span>
  <span class="p">},</span>
  <span class="nx">stats</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">colors</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">//日志彩色
</span><span class="c1"></span>  <span class="p">}</span>
<span class="p">}))</span>
<span class="c1">// 使用hotMiddleware中间件，实现热更新通信
</span><span class="c1"></span><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">hotMiddleware</span><span class="p">(</span><span class="nx">compiler</span><span class="p">,</span> <span class="p">{</span>
  <span class="c1">//! 热更新地址,记得前面加斜杠，跟路由的意思，最终会拼接成http://xxx:port/__webpack_hmr
</span><span class="c1"></span>  <span class="nx">path</span><span class="o">:</span> <span class="sb">`/</span><span class="si">${</span><span class="nx">HMR_PATH</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
  <span class="nx">log</span><span class="o">:</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{}</span>
<span class="p">}))</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>关键配置对应关系</strong></p>
<table>
<thead>
<tr>
<th>配置项</th>
<th>作用域</th>
<th>影响范围</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>publicPath</code></td>
<td>DevMiddleware</td>
<td>定义内存文件系统的访问路径 (http://localhost:9002/[publicPath])</td>
</tr>
<tr>
<td><code>path</code></td>
<td>HotMiddleware</td>
<td>WebSocket 服务端监听路径 (ws://localhost:9002/[path])</td>
</tr>
<tr>
<td><code>writeToDisk</code> 回调</td>
<td>DevMiddleware</td>
<td>控制哪些编译结果需要持久化到磁盘</td>
</tr>
<tr>
<td><code>headers</code> 跨域配置</td>
<td>DevMiddleware</td>
<td>解决开发时前后端分离导致的CORS问题</td>
</tr>
</tbody>
</table>
<p>启动后，会发现一个本地 服务器：
<img src="/images/nova-bff/hmr3.jpg" alt="hmr全流程"></p>
<p>更新代码时，代码更新，整个过程一直保持心跳：
<img src="/images/nova-bff/hmr1.jpg" alt="hmr全流程">
<img src="/images/nova-bff/hmr2.jpg" alt="hmr全流程"></p>
<p>至此，我们完成了手动实现热更新，也就是webpack开箱即用的devServer功能，完整的时序图：
<img src="/images/nova-bff/hmr-timeloop.png" alt="hmr全流程"></p>
<h2 id="基础建设">基础建设</h2>
<p>统一收拢页面启动的入口代码：
<img src="/images/nova-bff/boot.jpg" alt="boot"></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kr">import</span> <span class="p">{</span> <span class="nx">createApp</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&#34;vue&#34;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">pinia</span> <span class="nx">from</span> <span class="s2">&#34;$store&#34;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">ElementPlus</span> <span class="nx">from</span> <span class="s2">&#34;element-plus&#34;</span><span class="p">;</span>
<span class="c1">// import &#39;element-plus/dist/index.css&#39;
</span><span class="c1"></span><span class="kr">import</span> <span class="s1">&#39;element-plus/theme-chalk/index.css&#39;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">createWebHashHistory</span><span class="p">,</span> <span class="nx">createRouter</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;vue-router&#39;</span>
<span class="cm">/**
</span><span class="cm"> * 初始化页面入口
</span><span class="cm"> * @param {import(&#39;vue&#39;).Component} pageComponent 页面组件实例
</span><span class="cm"> * @param {Object} options 配置项 
</span><span class="cm"> * @param {import(&#39;vue-router&#39;).RouterOptions} [options.routes] 路由配置
</span><span class="cm"> * @param {Array&lt;string&gt;} [options.libs] 第三方库配置
</span><span class="cm"> */</span>
<span class="kr">const</span> <span class="nx">initPage</span> <span class="o">=</span> <span class="p">(</span><span class="nx">pageComponent</span><span class="p">,</span> <span class="p">{</span><span class="nx">routes</span> <span class="o">=</span> <span class="p">[],</span> <span class="nx">libs</span> <span class="o">=</span> <span class="p">[]}</span> <span class="o">=</span> <span class="p">{})</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">createApp</span><span class="p">(</span><span class="nx">pageComponent</span><span class="p">)</span>

  <span class="c1">//! 在挂载渲染点之前，使用各种中间件
</span><span class="c1"></span>  <span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">pinia</span><span class="p">)</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">ElementPlus</span><span class="p">)</span>
  
  <span class="c1">// 注册各种第三方组件，例如echarts
</span><span class="c1"></span>  <span class="k">if</span><span class="p">(</span><span class="nx">libs</span> <span class="o">&amp;&amp;</span> <span class="nx">libs</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span><span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">libs</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">libs</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span><span class="nx">routes</span> <span class="o">&amp;&amp;</span> <span class="nx">routes</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">router</span> <span class="o">=</span> <span class="nx">createRouter</span><span class="p">({</span>
      <span class="nx">history</span><span class="o">:</span> <span class="nx">createWebHashHistory</span><span class="p">(),</span>
      <span class="nx">routes</span><span class="p">,</span>
    <span class="p">})</span>
    <span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">router</span><span class="p">)</span>
    <span class="c1">// 等所有的路由（包括异步路由）加载好，再挂载
</span><span class="c1"></span>    <span class="nx">router</span><span class="p">.</span><span class="nx">isReady</span><span class="p">().</span><span class="nx">then</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="nx">app</span><span class="p">.</span><span class="nx">mount</span><span class="p">(</span><span class="s1">&#39;#root&#39;</span><span class="p">)</span>
    <span class="p">})</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">app</span><span class="p">.</span><span class="nx">mount</span><span class="p">(</span><span class="s1">&#39;#root&#39;</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="k">default</span> <span class="nx">initPage</span>
</code></pre></td></tr></table>
</div>
</div><p>这样每个页面的entry.page.js只需要引入即可：
<img src="/images/nova-bff/page1.jpg" alt="boot"></p>
<h3 id="请求适配器">请求适配器</h3>
<p>通过适配器模式来封装请求模块，符合单一原则。</p>
<p>例如你现在用的axios请求库，后面想换成superagent，可以无缝衔接。
首先封装请求适配模块的基类：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="cm">/**
</span><span class="cm"> * 请求适配器基类
</span><span class="cm"> */</span>
<span class="kr">export</span> <span class="k">default</span> <span class="kr">class</span> <span class="nx">BaseRequestAdapter</span> <span class="p">{</span>
  <span class="c1">//!!! 可以认为是两个抽象方法，子类必须实现它。
</span><span class="c1"></span>  <span class="cm">/**
</span><span class="cm">   * 发送请求
</span><span class="cm">   * @param {Object} options 请求配置
</span><span class="cm">   * @returns {Promise} 请求结果
</span><span class="cm">   */</span>
  <span class="nx">request</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;Adapter must implement request method&#39;</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="cm">/**
</span><span class="cm">   * 处理响应
</span><span class="cm">   * @param {Object} response 响应数据
</span><span class="cm">   */</span>
  <span class="nx">handleResponse</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;Adapter must implement handleResponse method&#39;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

</code></pre></td></tr></table>
</div>
</div><p>如果你用axios请求，你的实现类，必须实现上面的抽象方法：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kr">import</span> <span class="nx">BaseRequestAdapter</span> <span class="nx">from</span> <span class="s1">&#39;./base&#39;</span><span class="p">;</span>

<span class="kr">export</span> <span class="k">default</span> <span class="kr">class</span> <span class="nx">AxiosAdapter</span> <span class="kr">extends</span> <span class="nx">BaseRequestAdapter</span> <span class="p">{</span>
  <span class="nx">request</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">axios</span><span class="p">.</span><span class="nx">request</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">handleResponse</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

</code></pre></td></tr></table>
</div>
</div><p>假如某一天你想换一个请求库superagent，实现上面的抽象方法即可：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="c1">// 举例，如果不打算用axios了，换一个适配器即可
</span><span class="c1"></span><span class="kr">import</span> <span class="nx">BaseRequestAdapter</span> <span class="nx">from</span> <span class="s1">&#39;./base&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">superagent</span> <span class="nx">from</span> <span class="s1">&#39;superagent&#39;</span><span class="p">;</span>

<span class="kr">export</span> <span class="k">default</span> <span class="kr">class</span> <span class="nx">SuperagentAdapter</span> <span class="kr">extends</span> <span class="nx">BaseRequestAdapter</span> <span class="p">{</span>
  <span class="nx">request</span><span class="p">({</span> <span class="nx">url</span><span class="p">,</span> <span class="nx">method</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">params</span><span class="p">,</span> <span class="nx">headers</span> <span class="p">})</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">superagent</span><span class="p">[</span><span class="nx">method</span><span class="p">](</span><span class="nx">url</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">params</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">headers</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">handleResponse</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">response</span><span class="p">.</span><span class="nx">body</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>再具体的请求实现那：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kr">import</span> <span class="nx">AxiosAdapter</span> <span class="nx">from</span> <span class="s1">&#39;./request-adapters/axios&#39;</span><span class="p">;</span>

<span class="c1">// 默认使用 axios 适配器
</span><span class="c1"></span><span class="kd">let</span> <span class="nx">requestAdapter</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AxiosAdapter</span><span class="p">();</span>

<span class="cm">/**
</span><span class="cm"> * 设置请求适配器
</span><span class="cm"> * @param {BaseRequestAdapter} adapter 请求适配器实例
</span><span class="cm"> */</span>
<span class="kr">export</span> <span class="kr">const</span> <span class="nx">setRequestAdapter</span> <span class="o">=</span> <span class="p">(</span><span class="nx">adapter</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">requestAdapter</span> <span class="o">=</span> <span class="nx">adapter</span><span class="p">;</span>
<span class="p">};</span>
<span class="c1">// 例如我们要切换到 superagent，只需要引入它，设置它即可
</span><span class="c1"></span><span class="kr">import</span> <span class="p">{</span> <span class="nx">setRequestAdapter</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;$common/curl&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">SuperagentAdapter</span> <span class="nx">from</span> <span class="s1">&#39;$common/request-adapters/superagent&#39;</span><span class="p">;</span>

<span class="nx">setRequestAdapter</span><span class="p">(</span><span class="k">new</span> <span class="nx">SuperagentAdapter</span><span class="p">());</span>
</code></pre></td></tr></table>
</div>
</div><p>而我们的真正请求只需要关心requestAdapter</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kr">const</span> <span class="nx">curl</span> <span class="o">=</span> <span class="p">({</span>
  <span class="c1">//...
</span><span class="c1"></span><span class="p">})</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="c1">// 组装参数
</span><span class="c1"></span>  <span class="kr">const</span> <span class="nx">requestOptions</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1">//...
</span><span class="c1"></span>  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">requestAdapter</span><span class="p">.</span><span class="nx">request</span><span class="p">(</span><span class="nx">requestOptions</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">({</span>
      <span class="c1">//...
</span><span class="c1"></span>    <span class="p">})</span>
  <span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="c1">// ...
</span><span class="c1"></span>    <span class="k">return</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
  <span class="p">})</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="k">default</span> <span class="nx">curl</span>

<span class="c1">// 页面请求时
</span><span class="c1"></span><span class="kr">import</span> <span class="nx">$curl</span> <span class="nx">from</span> <span class="s2">&#34;$common/curl&#34;</span><span class="p">;</span>

<span class="nx">onMounted</span><span class="p">(</span><span class="kr">async</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">res</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">$curl</span><span class="p">({</span>
    <span class="nx">url</span><span class="o">:</span> <span class="s2">&#34;/api/project/list&#34;</span><span class="p">,</span>
    <span class="nx">method</span><span class="o">:</span> <span class="s2">&#34;get&#34;</span><span class="p">,</span>
    <span class="nx">query</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">page</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
      <span class="nx">pageSize</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="p">},</span>
  <span class="p">});</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;res is &#34;</span><span class="p">,</span> <span class="nx">res</span><span class="p">);</span>

<span class="p">});</span>
</code></pre></td></tr></table>
</div>
</div>
    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content">吴少林</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
        2025-03-27
        <a href="/commit/1b461c4d81c3ad16ca976184ab69850e07ca2e78" title="feat: 更新">(1b461c4)</a>
    </span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">许可协议</span>
    <span class="item-content">MIT</span>
  </p>
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/bff%E5%B1%82/">BFF层</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/bff%E7%9A%84%E6%9C%8D%E5%8A%A1%E7%AB%AF%E8%AE%BE%E8%AE%A1/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">BFF的服务端设计</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        <a class="next" href="/post/vue%E7%9A%84%E7%BB%84%E4%BB%B6%E9%97%B4%E9%80%9A%E4%BF%A1/">
            <span class="next-text nav-default">Vue的组件间通信</span>
            <span class="next-text nav-mobile">下一篇</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  
  <div id="vcomments"></div>
  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
  <script type="text/javascript">
    new Valine({
        el: '#vcomments' ,
        appId: 'YpBHjDSe3NF14qHWCnclFngj-gzGzoHsz',
        appKey: 'mXJxlZS7txiXxPeIOkz7GVEP',
        notify:  false ,
        verify:  false ,
        avatar:'mp',
        placeholder: '请留下你的宝贵意见~',
        visitor:  false 
    });
  </script>

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:wslsdust@163.com" class="iconfont icon-email" title="email"></a>
      <a href="https://github.com/codevvvv9" class="iconfont icon-github" title="github"></a>
  <a href="http://wushao666.github.io/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://gohugo.io">Hugo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2017 - 
    2025<span class="heart"><i class="iconfont icon-heart"></i></span><span>吴少林</span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
